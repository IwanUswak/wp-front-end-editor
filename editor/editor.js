(function($){if(FrontEndEditor._loaded){return}FrontEndEditor._loaded=true;(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=(typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name]))?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}function Class(){if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class}})();var DoubleClick={_event:false,_delayed:false,register:function($el,callback){$el.bind({click:DoubleClick.click,dblclick:DoubleClick.dblclick});$el.dblclick(callback)},click:function(ev){if($(ev.target).is("select, option")){return}if(DoubleClick._delayed){return}ev.stopImmediatePropagation();ev.preventDefault();if(DoubleClick._event){return}DoubleClick._event=ev;setTimeout(DoubleClick.resume,300)},resume:function(){if(!DoubleClick._event){return}var $target=$(DoubleClick._event.target);var new_event=$.Event("click");DoubleClick._delayed=true;$target.trigger(new_event);DoubleClick._delayed=false;if(new_event.isDefaultPrevented()){return}var $link=$target.closest("a");if(!$link.length){return}if(typeof $link.attr("href")!="undefined"&&$link.attr("href")!="#"){if($link.attr("target")=="_blank"){window.open($link.attr("href"))}else{window.location.href=$link.attr("href")}}DoubleClick._event=false},dblclick:function(ev){ev.stopPropagation();ev.preventDefault();DoubleClick._event=false}};var Overlay=Class.extend({init:function($el){this.el=$el;this.cover=$('<div class="fee-loading>').css("background-image","url("+FrontEndEditor.data.spinner+")").hide().prependTo($("body"))},show:function(){this.cover.css({width:this.el.width(),height:this.el.height()}).css(this.el.offset()).show()},hide:function(){this.cover.hide()}});var require=function(src,callback){if(require.cache[src]){callback();return}require.cache[src]=$("<script>").attr({type:"text/javascript",src:src,load:callback}).prependTo("head")};require.cache=[];SyncLoad=Class.extend({script_loaded:false,content_loaded:false,content:undefined,init:function(src,data,callback){var self=this;self.callback=callback;require(src,function(){self.script_loaded=true;self.proceed()});$.post(FrontEndEditor.data.ajax_url,data,function(content){self.content_loaded=true;self.content=content;self.proceed()})},proceed:function(){var self=this;if(self.script_loaded&&self.content_loaded){self.callback(self.content)}}});var fieldTypes={};fieldTypes.base=Class.extend({init:function($el,type,filter,data){var self=this;self.set_el($el);self.type=type;self.filter=filter;self.data=data;DoubleClick.register(self.el,$.proxy(self,"dblclick"))},set_el:function($el){var self=this;self.el=$el;var $parent=self.el.parents("a");if(!$parent.length){return}var $link=$parent.clone(true).html(self.el.html());var $wrap=self.el.clone(true).html($link);$parent.replaceWith($wrap);self.el=$wrap;self.switched=true},get_content:null,set_content:null,ajax_get_handler:null,ajax_set_handler:null,ajax_args:function(args){var self=this;return $.extend(args,{action:"front-end-editor",nonce:FrontEndEditor.data.nonce,filter:self.filter,data:self.data})},ajax_get:function(){var self=this;var data=self.ajax_args({callback:"get",});$.post(FrontEndEditor.data.ajax_url,data,$.proxy(self,"ajax_get_handler"))},ajax_set:function(content){var self=this;var data=self.ajax_args({callback:"save",content:content||self.get_content()});$.post(FrontEndEditor.data.ajax_url,data,$.proxy(self,"ajax_set_handler"))}});fieldTypes.image=fieldTypes.base.extend({dblclick:function(ev){var self=this;tb_show(FrontEndEditor.data.image.change,FrontEndEditor.data.admin_url+"/media-upload.php?post_id=0&type=image&TB_iframe=true&width=640&editable_image=1");$('<a id="fee-img-revert" href="#">').text(FrontEndEditor.data.image.revert).click(function(ev){self.ajax_set(-1)}).insertAfter("#TB_ajaxWindowTitle");$("#TB_closeWindowButton img").attr("src",FrontEndEditor.data.image.tb_close);$("#TB_iframeContent").load($.proxy(self,"replace_button"))},replace_button:function(ev){var self=this;var $frame=$(ev.target).contents();$(".media-item",$frame).livequery(function(){var $item=$(this);var $button=$('<a href="#" class="button">').text(FrontEndEditor.data.image.change).click(function(ev){self.ajax_set(self.get_content($item))});$item.find(":submit, #go_button").replaceWith($button)})},get_content:function($item){var $field;$field=$item.find(".urlfile");if($field.length){return $field.attr("title")}$field=$item.find("#embed-src");if($field.length){return $field.val()}$field=$item.find("#src");if($field.length){return $field.val()}return false},ajax_set_handler:function(url){var self=this;if(url==-1){window.location.reload(true)}else{self.el.find("img").attr("src",url);tb_remove()}}});fieldTypes.thumbnail=fieldTypes.image.extend({replace_button:function(ev){var self=this;var $frame=$(ev.target).contents();$frame.find("#tab-type_url").remove();self._super(ev)},get_content:function($item){return $item.attr("id").replace("media-item-","")}});fieldTypes.input=fieldTypes.base.extend({input_tag:'<input type="text">',init:function($el,type,name,id){var self=this;self._super($el,type,name,id);self.overlay=new Overlay(self.el)},create_input:function(){var self=this;self.input=$(self.input_tag).attr({id:"fee-"+new Date().getTime(),"class":"fee-form-content"});self.input.prependTo(self.form)},set_input:function(content){var self=this;self.input.val(content)},get_content:function(){var self=this;return self.input.val()},set_content:function(content){var self=this,$el=self.switched?self.el.find("a"):self.el;$el.html(content)},ajax_get:function(){var self=this;self.overlay.show();self.create_input();self._super()},ajax_set:function(){var self=this;self.overlay.show();self._super()},ajax_get_handler:function(content){var self=this;self.overlay.hide();self.el.hide().after(self.form);self.set_input(content);self.input.focus()},ajax_set_handler:function(content){var self=this;self.set_content(content);self.overlay.hide();self.el.show()},dblclick:function(ev){var self=this;self.save_button=$("<button>").addClass("fee-form-save").text(FrontEndEditor.data.save_text).click($.proxy(self,"form_submit"));self.cancel_button=$("<button>").addClass("fee-form-cancel").text(FrontEndEditor.data.cancel_text).click($.proxy(self,"form_remove"));self.form=(self.type.indexOf("input")>=0)?$("<span>"):$("<div>");self.form.addClass("fee-form").addClass("fee-type-"+self.type).addClass("fee-filter-"+self.filter).append(self.save_button).append(self.cancel_button);self.form.bind("keypress",$.proxy(self,"keypress"));self.ajax_get()},form_remove:function(ev){var self=this;self.remove_form(false);ev.stopPropagation();ev.preventDefault()},form_submit:function(ev){var self=this;self.ajax_set();self.remove_form(true);ev.stopPropagation();ev.preventDefault()},remove_form:function(with_spinner){var self=this;self.form.remove();self.el.show();if(true===with_spinner){self.overlay.show()}},keypress:function(ev){var self=this;var keys={ENTER:13,ESCAPE:27};var code=(ev.keyCode||ev.which||ev.charCode||0);if(code==keys.ENTER&&"input"==self.type){self.save_button.click()}if(code==keys.ESCAPE){self.cancel_button.click()}}});fieldTypes.terminput=fieldTypes.input.extend({ajax_get:function(){var self=this;var data=self.ajax_args({callback:"get",});self.overlay.show();self.create_input();new SyncLoad(FrontEndEditor.data.suggest.src,data,$.proxy(self,"ajax_get_handler"))},set_input:function(content){var self=this;self._super(content);self.input.suggest(FrontEndEditor.data.ajax_url+"?action=ajax-tag-search&tax="+self.data.taxonomy,{multiple:true,resultsClass:"fee-suggest-results",selectClass:"fee-suggest-over",matchClass:"fee-suggest-match"})}});fieldTypes.checkbox=fieldTypes.input.extend({input_tag:'<input type="checkbox">',set_input:function(content){var self=this,content=content?"checked":"";self.input.attr("checked",content)},set_content:function(content){var self=this,$el=self.switched?self.el.find("a"):self.el;content=self.data.values[self.input.is(":checked")];$el.html(content)},});fieldTypes.textarea=fieldTypes.input.extend({input_tag:'<textarea rows="10">'});fieldTypes.rich=fieldTypes.textarea.extend({ajax_get:function(){var self=this;var data=self.ajax_args({callback:"get",});self.overlay.show();self.create_input();new SyncLoad(FrontEndEditor.data.nicedit.src,data,$.proxy(self,"ajax_get_handler"))},set_input:function(content){var self=this;self._super(content);self.editor=new nicEditor(FrontEndEditor.data.nicedit).panelInstance(self.input.attr("id"));self.form.find(".nicEdit-main").focus()},get_content:function(){var self=this;return self.pre_wpautop(self.input.val())},pre_wpautop:function(content){var blocklist1,blocklist2;content=content.replace(/<(pre|script)[^>]*>[\s\S]+?<\/\1>/g,function(a){a=a.replace(/<br ?\/?>[\r\n]*/g,"<wp_temp>");return a.replace(/<\/?p( [^>]*)?>[\r\n]*/g,"<wp_temp>")});blocklist1="blockquote|ul|ol|li|table|thead|tbody|tfoot|tr|th|td|div|h[1-6]|p|fieldset";content=content.replace(new RegExp("\\s*</("+blocklist1+")>\\s*","g"),"</$1>\n");content=content.replace(new RegExp("\\s*<(("+blocklist1+")[^>]*)>","g"),"\n<$1>");content=content.replace(/(<p [^>]+>.*?)<\/p>/g,"$1</p#>");content=content.replace(/<div([^>]*)>\s*<p>/gi,"<div$1>\n\n");content=content.replace(/\s*<p>/gi,"");content=content.replace(/\s*<\/p>\s*/gi,"\n\n");content=content.replace(/\n[\s\u00a0]+\n/g,"\n\n");content=content.replace(/\s*<br ?\/?>\s*/gi,"\n");content=content.replace(/\s*<div/g,"\n<div");content=content.replace(/<\/div>\s*/g,"</div>\n");content=content.replace(/\s*\[caption([^\[]+)\[\/caption\]\s*/gi,"\n\n[caption$1[/caption]\n\n");content=content.replace(/caption\]\n\n+\[caption/g,"caption]\n\n[caption");blocklist2="blockquote|ul|ol|li|table|thead|tbody|tfoot|tr|th|td|h[1-6]|pre|fieldset";content=content.replace(new RegExp("\\s*<(("+blocklist2+") ?[^>]*)\\s*>","g"),"\n<$1>");content=content.replace(new RegExp("\\s*</("+blocklist2+")>\\s*","g"),"</$1>\n");content=content.replace(/<li([^>]*)>/g,"\t<li$1>");if(content.indexOf("<object")!=-1){content=content.replace(/<object[\s\S]+?<\/object>/g,function(a){return a.replace(/[\r\n]+/g,"")})}content=content.replace(/<\/p#>/g,"</p>\n");content=content.replace(/\s*(<p [^>]+>[\s\S]*?<\/p>)/g,"\n$1");content=content.replace(/^\s+/,"");content=content.replace(/[\s\u00a0]+$/,"");content=content.replace(/<wp_temp>/g,"\n");return content},ajax_set:function(){var self=this;self.editor.nicInstances[0].saveContent();self._super()}});fieldTypes.widget=fieldTypes.input.extend({create_input:function(){},set_input:function(content){var self=this;self.input=$(content);self.form.prepend(content)},get_content:function(){return""},ajax_args:function(args){var self=this;args=self._super(args);if("get"==args.callback){return args}var data={},raw_data=self.form.find(":input").serializeArray();for(var i in raw_data){data[raw_data[i].name]=raw_data[i].value}return $.extend(args,data)}});FrontEndEditor.fieldTypes=fieldTypes;$(document).ready(function($){var extract_data_attr=function(el){var $el=$(el),data={},attr;for(var i=0;i<el.attributes.length;i++){attr=el.attributes.item(i);if(attr.specified&&0==attr.name.indexOf("data-")){data[attr.name.substr(5)]=attr.value}}return data};$.each(FrontEndEditor.data.fields,function(i,filter){$(".fee-filter-"+filter).each(function(){var $el=$(this),data=extract_data_attr(this),type=data.type;new fieldTypes[type]($el,type,filter,data)})});if(FrontEndEditor.data.tooltip){$(".fee-field").qtip({content:FrontEndEditor.data.tooltip.text,position:{corner:{target:"topMiddle"},adjust:{x:0,y:-40}},show:{effect:"fade"},style:{height:10,paddingTop:"4px",paddingRight:"5px",paddingBottom:"6px",paddingLeft:"25px",background:"#bbbebf url("+FrontEndEditor.data.tooltip.icon+") top left no-repeat",color:"#ffffff",textAlign:"left",lineHeight:"100%",fontFamily:"sans-serif",fontSize:"14px",opacity:"0.75",border:{width:0,radius:5,color:"#bbbebf"},tip:"bottomLeft",name:"dark"}})}})})(jQuery);